{"version":3,"sources":["webpack:///./src/SmartComponents/Systems/Systems.js"],"names":["pageTitle","intl","messages","setPageTitle","dispatch","useDispatch","React","isRemediationLoading","setRemediationLoading","RemediationModalCmp","setRemediationModalCmp","systems","useSelector","entities","rows","shallowEqual","selectedRows","status","queryParams","totalItems","total","filter","search","systemProfile","selectedTags","showRemediationModal","data","resolvedData","apply","params","changeEntitiesParams","clearEntitiesStore","useRemoveFilter","deleteFilters","filterConfig","items","searchFilter","activeFiltersConfig","filters","buildFilterChips","onDelete","onSelect","useOnSelect","fetchSystems","limit","toSelect","type","payload","selectedCount","arrayFromObj","length","onExport","useOnExport","csv","exportSystemsCSV","json","exportSystemsJSON","prepareRemediationPairs","fetchApplicableAdvisoriesApi","then","fetchViewAdvisoriesSystems","advisories","map","advisory","id","getEntities","useGetEntities","title","headerOUIA","hasError","code","disableDefaultColumns","isFullView","autoRefresh","initialLoading","hideFilters","all","customFilters","patchParams","onLoad","mergeWithEntities","register","inventoryEntitiesReducer","systemsListColumns","modifyInventory","initialState","bulkSelect","useBulkSelectConfig","total_items","exportConfig","isDisabled","actions","systemsRowActions","tableProps","areActionsDisabled","rowData","applicableAdvisories","applicable_advisories","every","typeSum","canSelectAll","variant","TableVariant","className","isStickyHeader","dedicatedAction","onClick","remediationProviderWithPairs","filterSelectedRowIDs","transformPairs","isLoading","ouia"],"mappings":"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","file":"js/Systems.18758bd5b69d9fbcf227.js","sourcesContent":["import { TableVariant } from '@patternfly/react-table';\nimport { InventoryTable } from '@redhat-cloud-services/frontend-components/Inventory';\nimport { Main } from '@redhat-cloud-services/frontend-components/Main';\nimport React from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport messages from '../../Messages';\nimport searchFilter from '../../PresentationalComponents/Filters/SearchFilter';\nimport Header from '../../PresentationalComponents/Header/Header';\nimport ErrorHandler from '../../PresentationalComponents/Snippets/ErrorHandler';\nimport { register } from '../../store';\nimport { changeEntitiesParams, clearEntitiesStore } from '../../store/Actions/Actions';\nimport { initialState, inventoryEntitiesReducer, modifyInventory } from '../../store/Reducers/InventoryEntitiesReducer';\nimport {\n    exportSystemsCSV, exportSystemsJSON, fetchApplicableAdvisoriesApi,\n    fetchSystems, fetchViewAdvisoriesSystems\n} from '../../Utilities/api';\nimport {\n    arrayFromObj, buildFilterChips,\n    filterSelectedRowIDs, remediationProviderWithPairs,\n    transformPairs\n} from '../../Utilities/Helpers';\nimport {\n    setPageTitle, useBulkSelectConfig, useGetEntities, useOnExport, useOnSelect, useRemoveFilter\n} from '../../Utilities/Hooks';\nimport { intl } from '../../Utilities/IntlProvider';\nimport PatchRemediationButton from '../Remediation/PatchRemediationButton';\nimport RemediationModal from '../Remediation/RemediationModal';\nimport { systemsListColumns, systemsRowActions } from './SystemsListAssets';\n\nconst Systems = () => {\n    const pageTitle = intl.formatMessage(messages.titlesSystems);\n\n    setPageTitle(pageTitle);\n\n    const dispatch = useDispatch();\n    const [isRemediationLoading, setRemediationLoading] = React.useState(false);\n    const [\n        RemediationModalCmp,\n        setRemediationModalCmp\n    ] = React.useState(() => () => null);\n\n    const systems = useSelector(({ entities }) => entities?.rows || [], shallowEqual);\n    const selectedRows = useSelector(\n        ({ entities }) => entities?.selectedRows || []\n    );\n    const status = useSelector(\n        ({ entities }) => entities?.status || {}\n    );\n    const queryParams = useSelector(\n        ({ entities }) => entities?.queryParams || {}\n    );\n    const totalItems = useSelector(\n        ({ entities }) => entities?.total || 0\n    );\n\n    const { filter, search, systemProfile, selectedTags } = queryParams;\n\n    React.useEffect(() => {\n        return () => dispatch(clearEntitiesStore());\n    }, []);\n\n    async function showRemediationModal(data) {\n        setRemediationLoading(true);\n        const resolvedData = await data;\n        setRemediationModalCmp(() => () => <RemediationModal data={resolvedData} />);\n        setRemediationLoading(false);\n    }\n\n    function apply(params) {\n        dispatch(changeEntitiesParams(params));\n    }\n\n    const [deleteFilters] = useRemoveFilter({ search }, apply);\n\n    const filterConfig = {\n        items: [\n            searchFilter(apply, search,\n                intl.formatMessage(messages.labelsFiltersSystemsSearchTitle),\n                intl.formatMessage(messages.labelsFiltersSystemsSearchPlaceholder)\n            )\n        ]\n    };\n\n    const activeFiltersConfig = {\n        filters: buildFilterChips(filter, search),\n        onDelete: deleteFilters\n    };\n\n    const fetchAllData = (queryParams) =>\n        fetchSystems({ ...queryParams, limit: -1 });\n\n    const selectRows = (toSelect) => {\n        dispatch(\n            { type: 'SELECT_ENTITY', payload: toSelect }\n        );\n    };\n\n    const onSelect = useOnSelect(systems, selectedRows, fetchAllData, selectRows);\n\n    const selectedCount = selectedRows && arrayFromObj(selectedRows).length;\n\n    const onExport = useOnExport('systems', queryParams, {\n        csv: exportSystemsCSV,\n        json: exportSystemsJSON\n    }, dispatch);\n\n    const areActionsDisabled = (rowData) => {\n        const { applicable_advisories: applicableAdvisories } = rowData;\n        return applicableAdvisories && applicableAdvisories.every(typeSum => typeSum === 0);\n    };\n\n    const prepareRemediationPairs = (systems) => {\n        return fetchApplicableAdvisoriesApi({ limit: -1 }).then(\n            ({ data }) => fetchViewAdvisoriesSystems(\n                {\n                    advisories: data.map(advisory => advisory.id),\n                    systems\n                }\n            ));\n    };\n\n    const getEntities = useGetEntities(fetchSystems, apply);\n\n    return (\n        <React.Fragment>\n            <Header title={intl.formatMessage(messages.titlesPatchSystems)} headerOUIA={'systems'} />\n            <RemediationModalCmp />\n            <Main>\n                {status.hasError && <ErrorHandler code={status.code} /> ||\n                    (\n                        <InventoryTable\n                            disableDefaultColumns\n                            isFullView\n                            autoRefresh\n                            initialLoading\n                            hideFilters={{ all: true }}\n                            customFilters={{\n                                patchParams: {\n                                    search,\n                                    filter,\n                                    systemProfile,\n                                    selectedTags\n                                }\n                            }}\n                            onLoad={({ mergeWithEntities }) => {\n                                register({\n                                    ...mergeWithEntities(\n                                        inventoryEntitiesReducer(systemsListColumns, modifyInventory),\n                                        initialState\n                                    )\n                                });\n                            }}\n                            getEntities={getEntities}\n                            bulkSelect={useBulkSelectConfig(selectedCount, onSelect, { total_items: totalItems }, systems)}\n                            exportConfig={{\n                                isDisabled: totalItems === 0,\n                                onSelect: onExport\n                            }}\n                            actions={systemsRowActions(showRemediationModal)}\n                            filterConfig={filterConfig}\n                            activeFiltersConfig={activeFiltersConfig}\n                            tableProps={{\n                                areActionsDisabled,\n                                canSelectAll: false,\n                                variant: TableVariant.compact, className: 'patchCompactInventory', isStickyHeader: true\n                            }}\n                            dedicatedAction={(\n                                <PatchRemediationButton\n                                    onClick={() =>\n                                        showRemediationModal(\n                                            remediationProviderWithPairs(\n                                                filterSelectedRowIDs(selectedRows),\n                                                prepareRemediationPairs, transformPairs)\n                                        )}\n                                    isDisabled={arrayFromObj(selectedRows).length === 0 || isRemediationLoading}\n                                    isLoading={isRemediationLoading}\n                                    ouia={'toolbar-remediation-button'}\n                                />)}\n\n                        >\n                        </InventoryTable>\n                    )\n                }\n            </Main>\n        </React.Fragment>\n    );\n};\n\nexport default Systems;\n"],"sourceRoot":""}