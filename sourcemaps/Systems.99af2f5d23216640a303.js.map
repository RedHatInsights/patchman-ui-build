{"version":3,"sources":["webpack:///./src/SmartComponents/Systems/Systems.js"],"names":["pageTitle","intl","messages","setPageTitle","history","useHistory","dispatch","useDispatch","React","isRemediationLoading","setRemediationLoading","RemediationModalCmp","setRemediationModalCmp","decodedParams","decodeQueryparams","location","search","systems","useSelector","entities","rows","shallowEqual","totalItems","total","selectedRows","status","queryParams","SystemsStore","systemProfile","selectedTags","filter","page","perPage","sort","showRemediationModal","data","resolvedData","apply","params","changeSystemsParams","clearInventoryReducer","useRemoveFilter","deleteFilters","filterConfig","items","searchFilter","activeFiltersConfig","filters","buildFilterChips","onDelete","onSelect","useOnSelect","fetchSystems","limit","then","filterRemediatableSystems","toSelect","type","payload","selectedCount","arrayFromObj","length","onExport","useOnExport","csv","exportSystemsCSV","json","exportSystemsJSON","prepareRemediationPairs","fetchApplicableAdvisoriesApi","fetchViewAdvisoriesSystems","advisories","map","advisory","id","getEntities","useGetEntities","title","headerOUIA","hasError","code","disableDefaultColumns","isFullView","autoRefresh","initialLoading","hideFilters","all","customFilters","patchParams","onLoad","mergeWithEntities","register","inventoryEntitiesReducer","systemsListColumns","modifyInventory","persistantParams","bulkSelect","useBulkSelectConfig","total_items","exportConfig","isDisabled","actions","systemsRowActions","tableProps","areActionsDisabled","rowData","applicableAdvisories","applicable_advisories","every","typeSum","canSelectAll","variant","TableVariant","className","isStickyHeader","dedicatedAction","onClick","remediationProviderWithPairs","removeUndefinedObjectKeys","transformPairs","remediationIdentifiers","isLoading","ouia"],"mappings":"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","file":"js/Systems.00d93566a8927d4392e2.js","sourcesContent":["import { TableVariant } from '@patternfly/react-table';\nimport { InventoryTable } from '@redhat-cloud-services/frontend-components/Inventory';\nimport { Main } from '@redhat-cloud-services/frontend-components/Main';\nimport React from 'react';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport messages from '../../Messages';\nimport searchFilter from '../../PresentationalComponents/Filters/SearchFilter';\nimport Header from '../../PresentationalComponents/Header/Header';\nimport ErrorHandler from '../../PresentationalComponents/Snippets/ErrorHandler';\nimport { register } from '../../store';\nimport { changeSystemsParams, clearInventoryReducer } from '../../store/Actions/Actions';\nimport { inventoryEntitiesReducer, modifyInventory } from '../../store/Reducers/InventoryEntitiesReducer';\nimport {\n    exportSystemsCSV, exportSystemsJSON, fetchApplicableAdvisoriesApi,\n    fetchSystems, fetchViewAdvisoriesSystems\n} from '../../Utilities/api';\nimport { remediationIdentifiers } from '../../Utilities/constants';\nimport {\n    arrayFromObj, buildFilterChips,\n    removeUndefinedObjectKeys, remediationProviderWithPairs,\n    transformPairs, persistantParams, filterRemediatableSystems, decodeQueryparams\n} from '../../Utilities/Helpers';\nimport {\n    setPageTitle, useBulkSelectConfig, useGetEntities, useOnExport,\n    useOnSelect, useRemoveFilter\n} from '../../Utilities/Hooks';\nimport { intl } from '../../Utilities/IntlProvider';\nimport PatchRemediationButton from '../Remediation/PatchRemediationButton';\nimport RemediationModal from '../Remediation/RemediationModal';\nimport { systemsListColumns, systemsRowActions } from './SystemsListAssets';\nimport { useHistory } from 'react-router-dom';\n\nconst Systems = () => {\n    const pageTitle = intl.formatMessage(messages.titlesSystems);\n\n    setPageTitle(pageTitle);\n\n    const history = useHistory();\n    const dispatch = useDispatch();\n    const [isRemediationLoading, setRemediationLoading] = React.useState(false);\n    const [\n        RemediationModalCmp,\n        setRemediationModalCmp\n    ] = React.useState(() => () => null);\n\n    const decodedParams = decodeQueryparams(history.location.search);\n    const systems = useSelector(({ entities }) => entities?.rows || [], shallowEqual);\n    const totalItems = useSelector(\n        ({ entities }) => entities?.total || 0\n    );\n\n    const selectedRows = useSelector(\n        ({ entities }) => entities?.selectedRows || []\n    );\n    const status = useSelector(\n        ({ entities }) => entities?.status || {}\n    );\n    const queryParams = useSelector(\n        ({ SystemsStore }) => SystemsStore?.queryParams || {}\n    );\n\n    const { systemProfile, selectedTags,\n        filter, search, page, perPage, sort } = queryParams;\n\n    React.useEffect(() => {\n        apply(decodedParams);\n        return () => dispatch(clearInventoryReducer());\n    }, []);\n    async function showRemediationModal(data) {\n        setRemediationLoading(true);\n        const resolvedData = await data;\n        setRemediationModalCmp(() => () => <RemediationModal data={resolvedData} />);\n        setRemediationLoading(false);\n    }\n\n    function apply(params) {\n        dispatch(changeSystemsParams(params));\n    }\n\n    const [deleteFilters] = useRemoveFilter({ search }, apply);\n\n    const filterConfig = {\n        items: [\n            searchFilter(apply, search,\n                intl.formatMessage(messages.labelsFiltersSystemsSearchTitle),\n                intl.formatMessage(messages.labelsFiltersSystemsSearchPlaceholder)\n            )\n        ]\n    };\n\n    const activeFiltersConfig = {\n        filters: buildFilterChips(filter, search),\n        onDelete: deleteFilters\n    };\n\n    const fetchAllData = (queryParams) =>\n        fetchSystems({ ...queryParams, limit: -1 }).then(filterRemediatableSystems);\n\n    const selectRows = (toSelect) => {\n        dispatch(\n            { type: 'SELECT_ENTITY', payload: toSelect }\n        );\n    };\n\n    const onSelect = useOnSelect(systems, selectedRows, fetchAllData, selectRows);\n\n    const selectedCount = selectedRows && arrayFromObj(selectedRows).length;\n\n    const onExport = useOnExport('systems', queryParams, {\n        csv: exportSystemsCSV,\n        json: exportSystemsJSON\n    }, dispatch);\n\n    const areActionsDisabled = (rowData) => {\n        const { applicable_advisories: applicableAdvisories } = rowData;\n        return applicableAdvisories && applicableAdvisories.every(typeSum => typeSum === 0);\n    };\n\n    const prepareRemediationPairs = (systems) => {\n        return fetchApplicableAdvisoriesApi({ limit: -1 }).then(\n            ({ data }) => fetchViewAdvisoriesSystems(\n                {\n                    advisories: data.map(advisory => advisory.id),\n                    systems\n                }\n            ));\n    };\n\n    const getEntities = useGetEntities(fetchSystems, apply, {}, history);\n\n    return (\n        <React.Fragment>\n            <Header title={intl.formatMessage(messages.titlesPatchSystems)} headerOUIA={'systems'} />\n            <RemediationModalCmp />\n            <Main>\n                {status.hasError && <ErrorHandler code={status.code} /> ||\n                    (\n                        <InventoryTable\n                            disableDefaultColumns\n                            isFullView\n                            autoRefresh\n                            initialLoading\n                            hideFilters={{ all: true }}\n                            customFilters={{\n                                patchParams: {\n                                    search,\n                                    filter,\n                                    systemProfile,\n                                    selectedTags\n                                }\n                            }}\n                            onLoad={({ mergeWithEntities }) => {\n                                register({\n                                    ...mergeWithEntities(\n                                        inventoryEntitiesReducer(systemsListColumns, modifyInventory),\n                                        persistantParams({ page, perPage, sort, search }, decodedParams)\n                                    )\n                                });\n                            }}\n                            getEntities={getEntities}\n                            bulkSelect={useBulkSelectConfig(selectedCount, onSelect, { total_items: totalItems }, systems)}\n                            exportConfig={{\n                                isDisabled: totalItems === 0,\n                                onSelect: onExport\n                            }}\n                            actions={systemsRowActions(showRemediationModal)}\n                            filterConfig={filterConfig}\n                            activeFiltersConfig={activeFiltersConfig}\n                            tableProps={{\n                                areActionsDisabled,\n                                canSelectAll: false,\n                                variant: TableVariant.compact, className: 'patchCompactInventory', isStickyHeader: true\n                            }}\n                            dedicatedAction={(\n                                <PatchRemediationButton\n                                    onClick={() =>\n                                        showRemediationModal(\n                                            remediationProviderWithPairs(\n                                                removeUndefinedObjectKeys(selectedRows),\n                                                prepareRemediationPairs,\n                                                transformPairs,\n                                                remediationIdentifiers.advisory)\n                                        )}\n                                    isDisabled={arrayFromObj(selectedRows).length === 0 || isRemediationLoading}\n                                    isLoading={isRemediationLoading}\n                                    ouia={'toolbar-remediation-button'}\n                                />)}\n\n                        >\n                        </InventoryTable>\n                    )\n                }\n            </Main>\n        </React.Fragment>\n    );\n};\n\nexport default Systems;\n"],"sourceRoot":""}