{"version":3,"sources":["webpack://@redhat-cloud-services/frontend-components-inventory-patchman/./src/SmartComponents/Advisories/Advisories.js"],"names":["Advisories","history","pageTitle","intl","messages","setPageTitle","dispatch","useDispatch","React","firstMount","setFirstMount","advisories","useSelector","AdvisoryListStore","rows","expandedRows","queryParams","selectedRows","metadata","status","createAdvisoriesRows","apply","decodeQueryparams","location","search","push","encodeURLParams","fetchApplicableAdvisories","onCollapse","_","rowId","value","expandAdvisoryRow","getRowIdByIndexExpandable","onSelect","useOnSelect","fetchApplicableAdvisoriesApi","limit","toSelect","selectAdvisoryRow","advisory","id","onSort","useSortColumn","advisoriesColumns","sortBy","createSortBy","sort","onSetPage","useSetPage","onPerPageSelect","usePerPageSelect","params","changeAdvisoryListParams","errorState","STATUS_REJECTED","prepareRemediationPairs","issues","fetchSystems","then","data","fetchViewAdvisoriesSystems","systems","map","system","title","headerOUIA","columns","compact","onExport","format","date","Date","toISOString","replace","split","filename","exportAdvisoriesCSV","downloadFile","exportAdvisoriesJSON","JSON","stringify","remediationProvider","remediationProviderWithPairs","arrayFromObj","transformPairs","remediationButtonOUIA","tableOUIA","paginationOUIA","store","filterConfig","items","searchFilter","typeFilter","filter","publishDateFilter","propTypes","withRouter"],"mappings":"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","file":"js/Advisories.96c746366df25a93d5ad.js","sourcesContent":["import { Main } from '@redhat-cloud-services/frontend-components/Main';\nimport { Unavailable } from '@redhat-cloud-services/frontend-components/Unavailable';\nimport { downloadFile } from '@redhat-cloud-services/frontend-components-utilities/helpers';\nimport propTypes from 'prop-types';\nimport React from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport messages from '../../Messages';\nimport publishDateFilter from '../../PresentationalComponents/Filters/PublishDateFilter';\nimport searchFilter from '../../PresentationalComponents/Filters/SearchFilter';\nimport typeFilter from '../../PresentationalComponents/Filters/TypeFilter';\nimport Header from '../../PresentationalComponents/Header/Header';\nimport TableView from '../../PresentationalComponents/TableView/TableView';\nimport { advisoriesColumns } from '../../PresentationalComponents/TableView/TableViewAssets';\nimport {\n    changeAdvisoryListParams, expandAdvisoryRow,\n    fetchApplicableAdvisories, selectAdvisoryRow\n} from '../../store/Actions/Actions';\nimport {\n    exportAdvisoriesCSV, exportAdvisoriesJSON, fetchApplicableAdvisoriesApi,\n    fetchSystems, fetchViewAdvisoriesSystems\n} from '../../Utilities/api';\nimport { STATUS_REJECTED } from '../../Utilities/constants';\nimport { createAdvisoriesRows } from '../../Utilities/DataMappers';\nimport {\n    arrayFromObj, createSortBy, decodeQueryparams,\n    encodeURLParams, getRowIdByIndexExpandable, remediationProviderWithPairs, transformPairs\n} from '../../Utilities/Helpers';\nimport { setPageTitle, useOnSelect, usePerPageSelect, useSetPage, useSortColumn } from '../../Utilities/Hooks';\nimport { intl } from '../../Utilities/IntlProvider';\n\nconst Advisories = ({ history }) => {\n    const pageTitle = intl.formatMessage(messages.titlesAdvisories);\n\n    setPageTitle(pageTitle);\n\n    const dispatch = useDispatch();\n    const [firstMount, setFirstMount] = React.useState(true);\n    const advisories = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.rows\n    );\n\n    const expandedRows = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.expandedRows\n    );\n    const queryParams = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.queryParams\n    );\n    const selectedRows = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.selectedRows\n    );\n    const metadata = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.metadata\n    );\n    const status = useSelector(\n        ({ AdvisoryListStore }) => AdvisoryListStore.status\n    );\n\n    const rows = React.useMemo(\n        () => createAdvisoriesRows(advisories, expandedRows, selectedRows),\n        [advisories, expandedRows, selectedRows]\n    );\n\n    React.useEffect(() => {\n        if (firstMount) {\n            apply(decodeQueryparams(history.location.search));\n            setFirstMount(false);\n        } else {\n            history.push(encodeURLParams(queryParams));\n            dispatch(fetchApplicableAdvisories(queryParams));\n        }\n    }, [queryParams]);\n\n    const onCollapse = React.useCallback((_, rowId, value) =>\n        dispatch(\n            expandAdvisoryRow({\n                rowId: getRowIdByIndexExpandable(advisories, rowId),\n                value\n            })\n        )\n    );\n\n    const fetchAllData = () =>\n        fetchApplicableAdvisoriesApi({ limit: -1 });\n\n    const selectRows = (toSelect) => {\n        dispatch(\n            selectAdvisoryRow(toSelect)\n        );\n    };\n\n    const onSelect = useOnSelect(rows, selectedRows, fetchAllData, selectRows, (advisory) => advisory.id);\n\n    const onSort = useSortColumn(advisoriesColumns, apply, 2);\n    const sortBy = React.useMemo(\n        () => createSortBy(advisoriesColumns, metadata.sort, 2),\n        [metadata.sort]\n    );\n\n    const onExport = (_, format) => {\n        const date = new Date().toISOString().replace(/[T:]/g, '-').split('.')[0] + '-utc';\n        const filename = `applicable-advisories-${date}`;\n        if (format === 'csv') {\n            exportAdvisoriesCSV(queryParams).then(data => downloadFile(data, filename, 'csv'));\n        }\n        else {\n            exportAdvisoriesJSON(queryParams).then(data => downloadFile(JSON.stringify(data), filename, 'json'));\n        }\n    };\n\n    const onSetPage = useSetPage(metadata.limit, apply);\n    const onPerPageSelect = usePerPageSelect(apply);\n\n    function apply(params) {\n        dispatch(changeAdvisoryListParams(params));\n    }\n\n    const errorState  = status === STATUS_REJECTED && <Unavailable />;\n\n    const prepareRemediationPairs = (issues) => {\n        return fetchSystems({ limit: -1 }).then(\n            ({ data }) => fetchViewAdvisoriesSystems(\n                {\n                    advisories: issues,\n                    systems: data.map(system => system.id)\n                }\n            ));\n    };\n\n    return (\n        <React.Fragment>\n            <Header title={intl.formatMessage(messages.titlesPatchAdvisories)} headerOUIA={'advisories'}/>\n            <Main>\n                <TableView\n                    columns={advisoriesColumns}\n                    compact\n                    onCollapse={onCollapse}\n                    onSetPage={onSetPage}\n                    onPerPageSelect={onPerPageSelect}\n                    onSort={onSort}\n                    onExport={onExport}\n                    selectedRows={selectedRows}\n                    onSelect={onSelect}\n                    sortBy={sortBy}\n                    remediationProvider={() =>\n                        remediationProviderWithPairs(arrayFromObj(selectedRows), prepareRemediationPairs, transformPairs)\n                    }\n                    apply={apply}\n                    remediationButtonOUIA={'toolbar-remediation-button'}\n                    tableOUIA={'advisories-table'}\n                    paginationOUIA={'advisories-pagination'}\n                    store={{ rows, metadata, status, queryParams }}\n                    filterConfig={{\n                        items: [\n                            searchFilter(apply, queryParams.search,\n                                intl.formatMessage(messages.labelsFiltersSearchAdvisoriesTitle),\n                                intl.formatMessage(messages.labelsFiltersSearchAdvisoriesPlaceholder)\n                            ),\n                            typeFilter(apply, queryParams.filter),\n                            publishDateFilter(apply, queryParams.filter)\n                        ]\n                    }}\n                    errorState={errorState}\n                />\n            </Main>\n        </React.Fragment>\n    );\n};\n\nAdvisories.propTypes = {\n    history: propTypes.object\n};\n\nexport default withRouter(Advisories);\n"],"sourceRoot":""}